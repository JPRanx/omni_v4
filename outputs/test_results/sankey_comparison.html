<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cash Flow Sankey - Comparison</title>

  <!-- D3.js and D3-sankey -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>

  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #FAF6F0;
      color: #3D3128;
      padding: 2rem;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #3D3128;
    }

    .subtitle {
      text-align: center;
      color: #8B7355;
      margin-bottom: 2rem;
    }

    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .option-card {
      background: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .option-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #3D3128;
      margin-bottom: 1rem;
      text-align: center;
    }

    .chart-container {
      background: #FEFEFE;
      border: 1px solid #E8DCC8;
      border-radius: 0.5rem;
      padding: 1rem;
      min-height: 500px;
      position: relative;
    }

    .pros-cons {
      margin-top: 1rem;
      padding: 1rem;
      background: #FFF9F0;
      border-radius: 0.5rem;
    }

    .pros-cons h4 {
      font-size: 0.875rem;
      font-weight: 600;
      color: #3D3128;
      margin-bottom: 0.5rem;
    }

    .pros-cons ul {
      list-style: none;
      font-size: 0.875rem;
      color: #5D4E3A;
      line-height: 1.6;
    }

    .pros-cons li {
      padding-left: 1.5rem;
      position: relative;
    }

    .pros-cons li::before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: #2E7D32;
      font-weight: bold;
    }

    .pros-cons.cons li::before {
      content: "‚úó";
      color: #C44536;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .modal-preview {
      background: white;
      border-radius: 0.75rem;
      padding: 2rem;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .modal-header {
      background: linear-gradient(135deg, #B89968 0%, #D4A574 100%);
      color: white;
      padding: 1.5rem 2rem;
      border-radius: 0.75rem 0.75rem 0 0;
      margin: -2rem -2rem 2rem -2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .summary-bar {
      display: flex;
      justify-content: space-around;
      padding: 1rem;
      background: linear-gradient(135deg, rgba(144, 238, 144, 0.1) 0%, rgba(250, 246, 240, 0.5) 100%);
      border: 1px solid #E8DCC8;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .summary-item {
      text-align: center;
    }

    .summary-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      color: #8B7355;
      margin-bottom: 0.25rem;
    }

    .summary-value {
      font-size: 1.25rem;
      font-weight: 600;
    }

    /* D3 Sankey specific styles */
    .node rect {
      cursor: pointer;
      fill-opacity: 0.9;
      shape-rendering: crispEdges;
    }

    .node text {
      pointer-events: none;
      font-size: 12px;
      font-weight: 600;
      fill: #3D3128;
    }

    .link {
      fill: none;
      stroke-opacity: 0.3;
    }

    .link:hover {
      stroke-opacity: 0.6;
    }

    @media (max-width: 1200px) {
      .comparison-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üíµ Cash Flow Sankey Diagram - Comparison</h1>
    <p class="subtitle">Choose your preferred visualization style for the Cash Flow Modal</p>

    <div class="comparison-grid">
      <!-- Option 1: D3-Sankey -->
      <div class="option-card">
        <h2 class="option-title">Option 1: D3-Sankey</h2>
        <div class="chart-container" id="d3-chart"></div>

        <div class="pros-cons">
          <h4>Pros:</h4>
          <ul>
            <li>Highly customizable styling</li>
            <li>Smooth animations and transitions</li>
            <li>Full control over colors and labels</li>
            <li>Lightweight and fast rendering</li>
          </ul>
        </div>

        <div class="pros-cons cons">
          <h4>Cons:</h4>
          <ul>
            <li>More code to maintain</li>
            <li>Manual tooltip implementation</li>
            <li>Requires custom interaction logic</li>
          </ul>
        </div>
      </div>

      <!-- Option 2: Plotly.js -->
      <div class="option-card">
        <h2 class="option-title">Option 2: Plotly.js</h2>
        <div class="chart-container" id="plotly-chart"></div>

        <div class="pros-cons">
          <h4>Pros:</h4>
          <ul>
            <li>Built-in interactive tooltips</li>
            <li>Easy to implement and maintain</li>
            <li>Automatic hover effects</li>
            <li>Professional appearance out-of-box</li>
          </ul>
        </div>

        <div class="pros-cons cons">
          <h4>Cons:</h4>
          <ul>
            <li>Larger library size</li>
            <li>Less customization flexibility</li>
            <li>Fixed styling options</li>
          </ul>
        </div>
      </div>

      <!-- Full Modal Preview -->
      <div class="option-card full-width">
        <h2 class="option-title">Full Modal Preview (with Plotly.js)</h2>
        <div class="modal-preview">
          <div class="modal-header">
            <div class="modal-title">üíµ Cash Flow Analysis - Week Overview</div>
            <div style="opacity: 0.7; font-size: 0.875rem;">Owner View - All Restaurants</div>
          </div>

          <div class="summary-bar">
            <div class="summary-item">
              <div class="summary-label">üí∞ Cash In</div>
              <div class="summary-value" style="color: #2E7D32;">$12,450.50</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">üéØ Tips Out</div>
              <div class="summary-value" style="color: #1976D2;">$3,250.75</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">üè™ Vendors Out</div>
              <div class="summary-value" style="color: #C44536;">$4,800.00</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">üíµ Net Cash</div>
              <div class="summary-value" style="color: #2E7D32;">$4,399.75</div>
            </div>
          </div>

          <div class="chart-container" id="modal-preview-chart" style="min-height: 600px;"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Sample cash flow data
    const cashFlowData = {
      totalCash: 12450.50,
      tips: 3250.75,
      vendorPayouts: 4800.00,
      netCash: 4399.75
    };

    // ============================================
    // Option 1: D3-Sankey
    // ============================================
    function renderD3Sankey() {
      const width = document.getElementById('d3-chart').clientWidth - 32;
      const height = 450;

      // Create SVG
      const svg = d3.select("#d3-chart")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("viewBox", [0, 0, width, height]);

      // Define Sankey layout
      const sankey = d3.sankey()
        .nodeWidth(20)
        .nodePadding(40)
        .extent([[20, 20], [width - 20, height - 20]]);

      // Data structure
      const data = {
        nodes: [
          { name: "Customer Cash" },        // 0
          { name: "Tips" },                 // 1
          { name: "Vendor Payouts" },       // 2
          { name: "Net Cash" }              // 3
        ],
        links: [
          { source: 0, target: 1, value: cashFlowData.tips },
          { source: 0, target: 2, value: cashFlowData.vendorPayouts },
          { source: 0, target: 3, value: cashFlowData.netCash }
        ]
      };

      const { nodes, links } = sankey(data);

      // Color scale
      const colorScale = d3.scaleOrdinal()
        .domain(["Customer Cash", "Tips", "Vendor Payouts", "Net Cash"])
        .range(["#2E7D32", "#1976D2", "#C44536", "#2E7D32"]);

      // Draw links
      svg.append("g")
        .selectAll("path")
        .data(links)
        .join("path")
        .attr("class", "link")
        .attr("d", d3.sankeyLinkHorizontal())
        .attr("stroke", d => colorScale(d.target.name))
        .attr("stroke-width", d => Math.max(1, d.width));

      // Draw nodes
      const node = svg.append("g")
        .selectAll("g")
        .data(nodes)
        .join("g")
        .attr("class", "node");

      node.append("rect")
        .attr("x", d => d.x0)
        .attr("y", d => d.y0)
        .attr("height", d => d.y1 - d.y0)
        .attr("width", d => d.x1 - d.x0)
        .attr("fill", d => colorScale(d.name))
        .attr("rx", 4);

      // Add node labels
      node.append("text")
        .attr("x", d => d.x0 < width / 2 ? d.x1 + 6 : d.x0 - 6)
        .attr("y", d => (d.y1 + d.y0) / 2)
        .attr("dy", "0.35em")
        .attr("text-anchor", d => d.x0 < width / 2 ? "start" : "end")
        .text(d => `${d.name} ($${(d.value || 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })})`);
    }

    // ============================================
    // Option 2: Plotly.js
    // ============================================
    function renderPlotlySankey(containerId) {
      const data = [{
        type: "sankey",
        orientation: "h",
        node: {
          pad: 40,
          thickness: 25,
          line: {
            color: "#3D3128",
            width: 0.5
          },
          label: [
            "Customer Cash",
            "Tips",
            "Vendor Payouts",
            "Net Cash"
          ],
          color: [
            "#2E7D32",  // Customer Cash (green)
            "#1976D2",  // Tips (blue)
            "#C44536",  // Vendor Payouts (red)
            "#2E7D32"   // Net Cash (green)
          ],
          customdata: [
            `$${cashFlowData.totalCash.toLocaleString(undefined, { minimumFractionDigits: 2 })}`,
            `$${cashFlowData.tips.toLocaleString(undefined, { minimumFractionDigits: 2 })}`,
            `$${cashFlowData.vendorPayouts.toLocaleString(undefined, { minimumFractionDigits: 2 })}`,
            `$${cashFlowData.netCash.toLocaleString(undefined, { minimumFractionDigits: 2 })}`
          ],
          hovertemplate: '<b>%{label}</b><br>Amount: %{customdata}<extra></extra>'
        },
        link: {
          source: [0, 0, 0],  // Customer Cash splits into 3
          target: [1, 2, 3],  // Tips, Vendor Payouts, Net Cash
          value: [
            cashFlowData.tips,
            cashFlowData.vendorPayouts,
            cashFlowData.netCash
          ],
          color: [
            "rgba(25, 118, 210, 0.4)",   // Tips (blue)
            "rgba(196, 69, 54, 0.4)",    // Vendor Payouts (red)
            "rgba(46, 125, 50, 0.4)"     // Net Cash (green)
          ],
          hovertemplate: '<b>%{source.label} ‚Üí %{target.label}</b><br>Amount: $%{value:,.2f}<extra></extra>'
        }
      }];

      const layout = {
        font: {
          family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
          size: 13,
          color: '#3D3128'
        },
        paper_bgcolor: '#FEFEFE',
        plot_bgcolor: '#FEFEFE',
        margin: { t: 10, r: 10, b: 10, l: 10 }
      };

      const config = {
        responsive: true,
        displayModeBar: false
      };

      Plotly.newPlot(containerId, data, layout, config);
    }

    // Render both options
    renderD3Sankey();
    renderPlotlySankey('plotly-chart');
    renderPlotlySankey('modal-preview-chart');
  </script>
</body>
</html>